<div class="d-flex">
  <app-sidebar></app-sidebar>
  <div class="main-content w-100 bg-light min-vh-100" style="margin-left: 260px;">
    <app-navbar [pageTitle]="'Transaction Ledger'"></app-navbar>

    <div class="container-fluid p-4">
      
      <div class="card border-0 shadow-sm rounded-4 mb-4">
        <div class="card-body p-3">
          <div class="row g-3 align-items-center">
            
            <div class="col-md-4">
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control border-start-0 bg-light" 
                       placeholder="Search Txn ID, Consumer..." 
                       [(ngModel)]="searchQuery" (input)="applyFilters()">
              </div>
            </div>

            <div class="col-md-8 d-flex justify-content-md-end gap-2">
              <select class="form-select w-auto bg-light border-0 fw-medium" [(ngModel)]="selectedMode" (change)="applyFilters()">
                <option value="ALL">All Modes</option>
                <option value="UPI">UPI</option>
                <option value="CARD">Cards (Credit/Debit)</option>
                <option value="NET_BANKING">Net Banking</option>
              </select>
              
              <button class="btn btn-primary rounded-pill px-4" (click)="exportCSV()">
                <i class="bi bi-download me-2"></i> Export CSV
              </button>
            </div>

          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light text-muted small text-uppercase">
                <tr>
                  <th class="ps-4 py-3">Transaction Info</th>
                  <th>Consumer</th>
                  <th>Payment Mode</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th class="text-end pe-4">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let t of filteredPayments">
                  <td class="ps-4">
                    <div class="fw-bold text-dark text-truncate" style="max-width: 150px;" title="{{t.transactionId}}">
                      {{ t.transactionId }}
                    </div>
                    <small class="text-muted">Bill: #{{ t.billId | slice:0:8 }}</small>
                  </td>
                  <td>
                    <div class="fw-medium text-dark">{{ t.consumerName }}</div>
                    <small class="text-muted">{{ t.utilityType }}</small>
                  </td>
                  <td>
                    <span class="badge badge-mode rounded-pill"
                          [class.text-bg-success]="t.paymentMode === 'UPI'"
                          [class.text-bg-primary]="t.paymentMode === 'CREDIT_CARD' || t.paymentMode === 'DEBIT_CARD'"
                          [class.text-bg-warning]="t.paymentMode === 'NET_BANKING'"
                          [class.text-bg-secondary]="!['UPI','CREDIT_CARD','DEBIT_CARD','NET_BANKING'].includes(t.paymentMode)">
                      {{ t.paymentMode || 'UNKNOWN' }}
                    </span>
                  </td>
                  <td>
                    <span class="fw-bold text-dark">â‚¹{{ t.amount | number:'1.2-2' }}</span>
                  </td>
                  <td class="text-muted small">
                    {{ t.paymentDate | date:'mediumDate' }}<br>
                    {{ t.paymentDate | date:'shortTime' }}
                  </td>
                  <td class="text-end pe-4">
                    <button class="btn btn-sm btn-outline-danger rounded-pill px-3" (click)="downloadReceipt(t)">
                      <i class="bi bi-file-earmark-pdf me-1"></i> PDF
                    </button>
                  </td>
                </tr>

                <tr *ngIf="filteredPayments.length === 0 && !isLoading">
                  <td colspan="6" class="text-center py-5 text-muted">
                    <i class="bi bi-wallet2 fs-1 mb-2 d-block opacity-25"></i>
                    No transactions found.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>