<div class="d-flex">
  <app-sidebar></app-sidebar>
  <div class="main-content w-100 bg-light min-vh-100" style="margin-left: 260px;">
    <app-navbar [pageTitle]="'Outstanding Dues'"></app-navbar>

    <div class="container-fluid p-4">

      <div *ngIf="successMessage" class="alert alert-success d-flex align-items-center rounded-pill px-4 shadow-sm" 
           style="position: fixed; top: 80px; right: 20px; z-index: 1050; animation: fadeIn 0.3s;">
        <i class="bi bi-check-circle-fill me-2"></i> {{ successMessage }}
      </div>
      
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-header bg-white py-3 border-0 d-flex justify-content-between align-items-center">
          <div>
            <h5 class="fw-bold mb-0 text-danger">Defaulters List</h5>
            <p class="text-muted small mb-0">Track overdue payments and send reminders.</p>
          </div>
          <div class="input-group w-auto">
            <span class="input-group-text bg-light border-0"><i class="bi bi-search"></i></span>
            <input type="text" class="form-control border-0 bg-light" placeholder="Search Bill ID..." 
                   [(ngModel)]="searchTerm" (input)="filter()">
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="bg-light small text-uppercase text-muted">
              <tr>
                <th class="ps-4">Bill Info</th>
                <th>Due Date</th>
                <th>Overdue By</th>
                <th>Pending Amount</th>
                <th>Last Reminder</th> <th class="text-end pe-4">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let d of filteredList" [ngClass]="d.daysOverdue > 30 ? 'critical-row' : 'warning-row'">
                <td class="ps-4">
                  <div class="fw-bold text-dark">#{{ d.id | slice:0:8 }}</div>
                  <small class="text-muted">{{ d.connectionId }}</small>
                </td>
                <td>{{ d.dueDate | date:'mediumDate' }}</td>
                <td>
                  <span class="badge rounded-pill" 
                        [ngClass]="d.daysOverdue > 15 ? 'bg-danger' : 'bg-warning text-dark'">
                    {{ d.daysOverdue }} Days
                  </span>
                </td>
                <td class="fw-bold text-danger">â‚¹{{ d.totalAmount | number:'1.2-2' }}</td>
                
                <td>
                  <span *ngIf="d.lastReminderSent" class="text-muted small">
                    <i class="bi bi-clock-history me-1"></i> {{ d.lastReminderSent | date:'short' }}
                  </span>
                  <span *ngIf="!d.lastReminderSent" class="badge bg-light text-secondary border">Never</span>
                </td>

                <td class="text-end pe-4">
                  <button class="btn btn-sm btn-outline-danger rounded-pill px-3" 
                          (click)="sendReminder(d)" 
                          [disabled]="processingId === d.id">
                    <span *ngIf="processingId === d.id" class="spinner-border spinner-border-sm me-2"></span>
                    {{ processingId === d.id ? 'Sending...' : 'Send Reminder' }}
                  </button>
                </td>
              </tr>
              
              <tr *ngIf="filteredList.length === 0 && !isLoading">
                <td colspan="6" class="text-center py-5 text-muted">
                  <i class="bi bi-check2-circle fs-1 text-success d-block mb-2"></i>
                  No overdue bills found! Great job.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>